<!-- MHonArc v2.6.18 -->
<!--X-Subject: Re: Object orientation in es, and a bug? -->
<!--X-From-R13: sevrqznaNpyv.pbz (@bnu Tevrqzna) -->
<!--X-Date: Wed, 14 Dec 1994 13:48:15 &#45;0500 -->
<!--X-Message-Id: 9412141848.AA13700@tepui -->
<!--X-Content-Type: text/plain -->
<!--X-Reference: 9412141718.AA12383@tepui -->
<!--X-Reference: 1994&#45;12&#45;14.185008.hanche@pride.imf.unit.no -->
<!--X-Reference: hanche@imf.unit.no -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>Re: Object orientation in es, and a bug?</title>
<link rev="made" href="mailto:friedman@cli.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00804.html">Date Prev</a>][<a href="msg00806.html">Date Next</a>][<a href="msg00804.html">Thread Prev</a>][<a href="msg00806.html">Thread Next</a>][<a href="maillist.html#00805">Date Index</a>][<a href="threads.html#00805">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>Re: Object orientation in es, and a bug?</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:hanche%40imf.unit.no">hanche@imf.unit.no</a></li>
<li><em>Subject</em>: Re: Object orientation in es, and a bug?</li>
<li><em>From</em>: <a href="mailto:friedman%40cli.com">friedman@cli.com</a> (Noah Friedman)</li>
<li><em>Date</em>: Wed, 14 Dec 1994 13:48:07 -0500</li>
<li><em>Cc</em>: <a href="mailto:es%40hawkwind.utcs.toronto.edu">es@hawkwind.utcs.toronto.edu</a></li>
<li><em>In-reply-to</em>: &lt;hanche@imf.unit.no&gt; Wed, 14 December 1994 19:10:16 +0100</li>
<li><em>References</em>: &lt;9412141718.AA12383@tepui&gt;	&lt;<a href="msg00804.html">1994-12-14.185008.hanche@pride.imf.unit.no</a>&gt;</li>
<li><em>Reply-to</em>: <a href="mailto:friedman%40cli.com">friedman@cli.com</a></li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>&gt;:&gt; Yes, it's a documented bug that closures aren't preserved across es
&gt;:&gt; invocations.  That's because when a new shell starts up, it just has a
&gt;:&gt; bunch of environment strings with no indication that any of the closures
&gt;:&gt; they represent were shared originally.
&gt;
&gt;Yes, but I thought this only applied in cases like
&gt;
&gt;let (shared=....) {
&gt;  fn fee ... {...}
&gt;  fn fie ... {...}
&gt;  fn foe ... {...}
&gt;  fn foo ... {...} }
&gt;
&gt;where fee, fie, foe and foo have separate print representations that
&gt;must become completely separate in the inferior shell.  But in my case
&gt;I had only one global object possessing internal functions, and in
&gt;this case I don't understand why what happened _must_ happen.

Well, if you look at the print representation you posted, it looked like:

  ; echo $f
  %closure(*=;s=fee fie foe foo;push='%closure(*=;s=fee fie foe foo)@
  items{s=$items $s}';pop='%closure(*=;s=fee fie foe
  foo;push=''%closure(*=;s=fee fie foe foo)@ items{s=$items $s}'')@ *
  {let(a=$s(1)){%seq {s=$s(2 ...)} {result $a}}}';all='%closure(*=;s=fee
  fie foe foo;push=''%closure(*=;s=fee fie foe foo)@ items{s=$items
  $s}'';pop=''%closure(*=;s=fee fie foe foo;push=''''%closure(*=;s=fee
  fie foe foo)@ items{s=$items $s}'''')@ * {let(a=$s(1)){%seq {s=$s(2
  ...)} {result $a}}}'')@ * {result $s}')@ method args{$($method) $args}

There are lots of &quot;fee fie foe foo&quot; closures that the subshell doesn't
realize are the same ones.

I think you can minimize this lossage by defining the stack as a procedure
in a closure with only a single lexically-scoped variable, that returns
message-passing procedures you can apply (got all that?).  Because you only
have one %closure() in the resulting string, there isn't a problem of
losing connectivity between closures (as long as you don't assign the stack
object to multiple variables).  This also avoids the exponential quoting
problem.

Note that the getters and setters are still lexically scoped although
they're a bit more cumbersome to access, so I defined some syntactic sugar
afterwards.

Hmm.  Does this implementation cause new getter/setter procedures to be
created each time the object is invoked?


    fn make-stack   stack {
        # comment this out if you want to be able to initialize the stack.
        stack=
        result { result (
                   # push
                   @ item { stack = $item $stack }

                   # pop
                   { 
                     let (a = $stack(1)) 
                       { 
                         stack = $stack(2 ...)
                         result $a
                       }
                   }

                   # all
                   { result $stack }
                 )
               }
    }

    fn push! obj args { let (fun = &lt;={ $obj }) { $fun(1) $args } }
    fn pop!  obj      { let (fun = &lt;={ $obj }) { $fun(2) } }
    fn all   obj      { let (fun = &lt;={ $obj }) { $fun(3) } }

A demonstration:

    ; s = &lt;={ make-stack }
    ; echo $s
    %closure(stack=){result @ item{stack=$item $stack} {let(a=$stack(1)){%seq {stack=$stack(2 ...)} {result $a}}} {result $stack}}
    ; push! $s a
    ; push! $s b
    ; push! $s c
    ; echo $s
    %closure(stack=c b a){result @ item{stack=$item $stack} {let(a=$stack(1)){%seq {stack=$stack(2 ...)} {result $a}}} {result $stack}}
    ; all $s
    # result 1 = c
    # result 2 = b
    # result 3 = a
    ; pop! $s
    # result = c
    ; all $s
    # result 1 = b
    # result 2 = a
    ; 

Kill me now.

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<ul><li><strong>References</strong>:
<ul>
<li><strong><a name="00802" href="msg00802.html">Object orientation in es, and a bug?</a></strong>
<ul><li><em>From:</em> friedman@gnu.ai.mit.edu (Noah Friedman)</li></ul></li>
<li><strong><a name="00804" href="msg00804.html">Re: Object orientation in es, and a bug?</a></strong>
<ul><li><em>From:</em> Harald Hanche-Olsen &lt;hanche@imf.unit.no&gt;</li></ul></li>
</ul></li></ul>
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00804.html">Re: Object orientation in es, and a bug?</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00806.html">Re: Object orientation in es, and a bug?</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00804.html">Re: Object orientation in es, and a bug?</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00806.html">Re: Object orientation in es, and a bug?</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00805"><strong>Date</strong></a></li>
<li><a href="threads.html#00805"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
