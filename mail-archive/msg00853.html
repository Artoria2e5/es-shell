<!-- MHonArc v2.6.18 -->
<!--X-Subject: cd tracking symbolic links -->
<!--X-From-R13: Bnhy Vnnue <unnueNargpbz.pbz> -->
<!--X-Date: Mon, 17 Jul 1995 05:58:37 &#45;0400 -->
<!--X-Message-Id: 4568.9507170956@bessie.harlequin.co.uk -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>cd tracking symbolic links</title>
<link rev="made" href="mailto:haahr@netcom.com">
</head>
<body>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg00852.html">Date Prev</a>][<a href="msg00854.html">Date Next</a>][<a href="msg00852.html">Thread Prev</a>][<a href="msg00854.html">Thread Next</a>][<a href="maillist.html#00853">Date Index</a>][<a href="threads.html#00853">Thread Index</a>]
<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>cd tracking symbolic links</h1>
<hr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>To</em>: <a href="mailto:es%40hawkwind.utcs.toronto.edu">es@hawkwind.utcs.toronto.edu</a></li>
<li><em>Subject</em>: cd tracking symbolic links</li>
<li><em>From</em>: Paul Haahr &lt;<a href="mailto:haahr%40netcom.com">haahr@netcom.com</a>&gt;</li>
<li><em>Date</em>: Mon, 17 Jul 1995 05:56:22 -0400</li>
<li><em>Reply-to</em>: Paul Haahr &lt;<a href="mailto:haahr%40netcom.com">haahr@netcom.com</a>&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>(I hesitate to raise this issue, because two years ago we had a long
debate over what the shell should do, but it came up in a private
discussion I was in and, since I wrote the code, I thought someone
might be interested in it.  I don't think it's the right thing for the
shell to do, but other people do.  Es is about being able to customize
the shell in interesting ways.  Vive la difference.)

Enclosed is a spoofing of cd and pwd to give es the same behavior as
(ba k tc z)^sh when cd'ing across symbolic links:  with this change,
cd ..  always takes one back one directory in the path, not to the
parent directory in on-disk structure.

I believe that this has to be installed before $cdpath searching, if
you use both of them in combination.

Paul

----

# es hack to make cd &quot;follow&quot; symbolic links, so that cd symlink/..
# returns one to the intial directory, not the parent of the directory
# pointed to by the symlink.

fn pwd {
    if {~ $#cwd 0} {
	noexport = $noexport cwd
	cwd = `` \n /bin/pwd
    }
    echo $cwd
}

let (cd = $fn-cd) fn cd dir {
    if {~ $#cwd 0} {
	noexport = $noexport cwd
    }
    if {~ $#dir 0} {
	$cd
	cwd = ~
    } {
	let (current = &lt;={
	    if {~ $dir /*} {
		result
	    } {
		if {~ $#cwd 0} {
		    cwd = `` \n /bin/pwd
		}
		%split / $cwd
	    }
	}) {
	    for (name = &lt;={%split / $dir}) {
		if {~ $name ..} {
		    if {!~ $#current 0} {
			let (x = 1 $current) current = $x(2 ... $#current)
		    }
		} {!~ $name . ''} {
		    current = $current $name
		}
	    }
	    let (path = / ^ &lt;={ %flatten / $current }) {
		$cd $path
		cwd = $path
	    }
	}
    }
}


</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00859" href="msg00859.html">Re: cd tracking symbolic links</a></strong>
<ul><li><em>From:</em> gsstark@MIT.EDU</li></ul></li>
<li><strong><a name="00854" href="msg00854.html">Re: cd tracking symbolic links</a></strong>
<ul><li><em>From:</em> &quot;Gregory L. Snead&quot; &lt;gsnead@harlequin.com&gt;</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg00852.html">[no subject]</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg00854.html">Re: cd tracking symbolic links</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg00852.html">[no subject]</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg00854.html">Re: cd tracking symbolic links</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="maillist.html#00853"><strong>Date</strong></a></li>
<li><a href="threads.html#00853"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
